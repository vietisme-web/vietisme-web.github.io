<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast 8x8</title>
<style>
body {display:flex; flex-direction:column; align-items:center; font-family:Arial; background:#f0f0f0; margin:0; padding:20px;}
h1 {color:#222;}
#game {display:grid; grid-template-columns:repeat(8,50px); grid-template-rows:repeat(8,50px); gap:2px; margin-top:20px;}
.cell {width:50px; height:50px; background:#eee; border:1px solid #ccc; border-radius:5px; transition:0.2s; cursor:pointer;}
.cell.empty {background:#eee;}
.exploding {animation:explode 0.3s ease forwards;}
@keyframes explode {0%{transform:scale(1);opacity:1;}50%{transform:scale(1.5);opacity:0.7;}100%{transform:scale(1);opacity:1;}}
#pieces {display:flex; gap:10px; margin-top:20px;}
.piece {display:grid; gap:2px; cursor:pointer; border-radius:5px; border:1px solid #888; padding:2px;}
.piece div{width:20px; height:20px; border-radius:3px;}
.piece:hover{transform:scale(1.1);}
#score{margin-top:20px; font-size:20px; font-weight:bold;}
#leaderboard {margin-top:20px; width:250px; background:white; padding:10px; border-radius:5px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
#leaderboard h2{text-align:center;margin:5px 0;}
#leaderboard ol {padding-left:20px;}
button {padding:10px 20px; margin-top:10px; cursor:pointer; font-size:16px;}
</style>
</head>
<body>

<h1>Block Blast 8x8 üé®</h1>
<div id="game"></div>
<div id="pieces"></div>
<div id="score">ƒêi·ªÉm: 0</div>
<button onclick="resetGame()">B·∫Øt ƒë·∫ßu l·∫°i</button>
<div id="leaderboard">
<h2>B·∫£ng x·∫øp h·∫°ng</h2>
<ol id="leaderboardList"></ol>
</div>

<script>
const rows=8,cols=8;
const colors=['#f44336','#2196F3','#4CAF50','#FFEB3B','#FF9800','#9C27B0'];
let grid=[],score=0,combo=0;
const gameDiv=document.getElementById('game');
const piecesDiv=document.getElementById('pieces');
const scoreDiv=document.getElementById('score');
const lbList=document.getElementById('leaderboardList');
let currentPieces=[],selectedPiece=null;

// t·∫°o grid
function createGrid(){
gameDiv.innerHTML='';
grid=[];
for(let r=0;r<rows;r++){
  const row=[];
  for(let c=0;c<cols;c++){
    row.push(null);
    const cell=document.createElement('div');
    cell.className='cell empty';
    cell.dataset.row=r;
    cell.dataset.col=c;
    gameDiv.appendChild(cell);
  }
  grid.push(row);
}
}

// t·∫°o 3 kh·ªëi b·∫•t k·ª≥
function randomPiece(){
  const shapes=[
    [[1]],[[1,1]],[[1],[1]],[[1,1],[1,0]],[[1,1],[1,1]]
  ];
  const shape=shapes[Math.floor(Math.random()*shapes.length)];
  const pieceColor=colors[Math.floor(Math.random()*colors.length)];
  return {shape, color:pieceColor};
}

function generatePieces(){
  piecesDiv.innerHTML='';
  currentPieces=[];
  for(let i=0;i<3;i++){
    const piece=randomPiece();
    currentPieces.push(piece);
    const div=document.createElement('div');
    div.className='piece';
    div.dataset.index=i;
    div.style.gridTemplateColumns=`repeat(${piece.shape[0].length},20px)`;
    div.style.gridTemplateRows=`repeat(${piece.shape.length},20px)`;
    piece.shape.forEach(r=>{
      r.forEach(v=>{
        const c=document.createElement('div');
        c.style.background=v?piece.color:'transparent';
        div.appendChild(c);
      })
    });
    div.onclick=()=>selectedPiece=i;
    piecesDiv.appendChild(div);
  }
}

// ƒë·∫∑t kh·ªëi
function placePiece(r,c,piece){
  const {shape,color}=piece;
  for(let i=0;i<shape.length;i++){
    for(let j=0;j<shape[i].length;j++){
      if(shape[i][j]){
        if(r+i>=rows||c+j>=cols||grid[r+i][c+j]) return false;
      }
    }
  }
  for(let i=0;i<shape.length;i++){
    for(let j=0;j<shape[i].length;j++){
      if(shape[i][j]){
        grid[r+i][c+j]=color;
      }
    }
  }
  updateGrid();
  return true;
}

// c·∫≠p nh·∫≠t grid
function updateGrid(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const idx=r*cols+c;
      const cell=gameDiv.children[idx];
      if(grid[r][c]){
        cell.style.background=grid[r][c];
        cell.classList.remove('empty');
      }else{
        cell.style.background='#eee';
        cell.classList.add('empty');
      }
    }
  }
}

// ki·ªÉm tra h√†ng/c·ªôt ƒë·∫ßy
function checkFullLines(){
  let exploded=false;
  for(let r=0;r<rows;r++){
    if(grid[r].every(v=>v!==null)){
      exploded=true;
      for(let c=0;c<cols;c++){
        const idx=r*cols+c;
        gameDiv.children[idx].classList.add('exploding');
        grid[r][c]=null;
      }
      score+=cols*10*(combo+1);
      combo++;
      setTimeout(()=>updateGrid(),300);
    }
  }
  for(let c=0;c<cols;c++){
    let full=true;
    for(let r=0;r<rows;r++){
      if(!grid[r][c]) full=false;
    }
    if(full){
      exploded=true;
      for(let r=0;r<rows;r++){
        const idx=r*cols+c;
        gameDiv.children[idx].classList.add('exploding');
        grid[r][c]=null;
      }
      score+=rows*10*(combo+1);
      combo++;
      setTimeout(()=>updateGrid(),300);
    }
  }
  if(!exploded) combo=0;
}

// ƒë·∫∑t kh·ªëi khi click
gameDiv.addEventListener('click',e=>{
  const cell=e.target;
  if(!cell.classList.contains('cell')||selectedPiece===null) return;
  const r=parseInt(cell.dataset.row);
  const c=parseInt(cell.dataset.col);
  const piece=currentPieces[selectedPiece];
  if(placePiece(r,c,piece)){
    currentPieces.splice(selectedPiece,1);
    selectedPiece=null;
    generatePieces();
    checkFullLines();
    updateScore();
  }
});

// c·∫≠p nh·∫≠t ƒëi·ªÉm + leaderboard
function updateScore(){
  scoreDiv.textContent='ƒêi·ªÉm: '+score;
  updateLeaderboard();
}

function updateLeaderboard(){
  let lb=JSON.parse(localStorage.getItem('bb_lb')||'[]');
  if(!lb.includes(score)) lb.push(score);
  lb.sort((a,b)=>b-a);
  lb=lb.slice(0,5);
  localStorage.setItem('bb_lb',JSON.stringify(lb));
  lbList.innerHTML='';
  lb.forEach(s=>{
    const li=document.createElement('li');
    li.textContent=s;
    lbList.appendChild(li);
  });
}

function resetGame(){
  score=0;
  combo=0;
  createGrid();
  generatePieces();
  updateScore();
}

// start
resetGame();
</script>

</body>
</html>
