<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast Clone</title>
<style>
  body {display:flex; flex-direction:column; align-items:center; font-family:Arial; background:#f0f0f0; margin:0; padding:20px;}
  h1 {color:#222;}
  #game {display:grid; grid-template-columns:repeat(9, 40px); grid-template-rows:repeat(9, 40px); gap:2px; margin-top:20px;}
  .cell {width:40px; height:40px; background:#ccc; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:20px; cursor:pointer; border-radius:5px; transition:0.2s;}
  #score {margin-top:20px; font-size:18px;}
  button {padding:10px 20px; margin-top:10px; cursor:pointer; font-size:16px;}
</style>
</head>
<body>

<h1>Block Blast Clone üü¶</h1>
<div id="game"></div>
<div id="score">ƒêi·ªÉm: 0</div>
<button onclick="resetGame()">B·∫Øt ƒë·∫ßu l·∫°i</button>

<script>
const rows = 9;
const cols = 9;
let grid = [];
let score = 0;
const colors = ['red','blue','green','yellow','orange','purple'];

const gameDiv = document.getElementById('game');
const scoreDiv = document.getElementById('score');

function randomColor(){ return colors[Math.floor(Math.random()*colors.length)]; }

function createGrid(){
  gameDiv.innerHTML = '';
  grid = [];
  for(let r=0;r<rows;r++){
    const row = [];
    for(let c=0;c<cols;c++){
      const color = randomColor();
      row.push(color);
      const cell = document.createElement('div');
      cell.className='cell';
      cell.style.background=color;
      cell.dataset.row=r;
      cell.dataset.col=c;
      cell.addEventListener('click', ()=>handleClick(r,c));
      gameDiv.appendChild(cell);
    }
    grid.push(row);
  }
}

function updateGrid(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const idx = r*cols + c;
      const cellDiv = gameDiv.children[idx];
      cellDiv.style.background = grid[r][c] || '#ccc';
    }
  }
}

function handleClick(r,c){
  const color = grid[r][c];
  if(!color) return;
  const matched = [];
  const visited = Array(rows).fill(0).map(()=>Array(cols).fill(false));
  
  function dfs(x,y){
    if(x<0||y<0||x>=rows||y>=cols) return;
    if(visited[x][y]) return;
    if(grid[x][y]!==color) return;
    visited[x][y]=true;
    matched.push([x,y]);
    dfs(x+1,y); dfs(x-1,y); dfs(x,y+1); dfs(x,y-1);
  }
  
  dfs(r,c);
  if(matched.length<2) return; // √≠t nh·∫•t 2 √¥ m·ªõi n·ªï
  matched.forEach(([x,y])=>grid[x][y]=null);
  score += matched.length*10;
  collapseGrid();
  updateGrid();
  scoreDiv.textContent='ƒêi·ªÉm: '+score;
}

function collapseGrid(){
  // ƒë·∫©y c√°c √¥ xu·ªëng
  for(let c=0;c<cols;c++){
    let stack=[];
    for(let r=rows-1;r>=0;r--){
      if(grid[r][c]) stack.push(grid[r][c]);
    }
    for(let r=rows-1;r>=0;r--){
      grid[r][c]=stack.length>0?stack.shift():null;
    }
  }
  // ƒë·∫©y c√°c c·ªôt sang tr√°i n·∫øu tr·ªëng
  let write=0;
  for(let c=0;c<cols;c++){
    if(grid[rows-1][c]){
      if(c!==write){
        for(let r=0;r<rows;r++){
          grid[r][write]=grid[r][c];
          grid[r][c]=null;
        }
      }
      write++;
    }
  }
}

function resetGame(){
  score=0;
  scoreDiv.textContent='ƒêi·ªÉm: 0';
  createGrid();
}

// start
createGrid();
</script>

</body>
</html>
