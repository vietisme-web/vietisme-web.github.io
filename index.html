<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast 8x8 n√¢ng c·∫•p</title>
<style>
  body {display:flex; flex-direction:column; align-items:center; font-family:Arial; background:#f0f0f0; margin:0; padding:20px;}
  h1 {color:#222;}
  #game {display:grid; grid-template-columns:repeat(8, 50px); grid-template-rows:repeat(8, 50px); gap:2px; margin-top:20px;}
  .cell {width:50px; height:50px; background:#eee; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:20px; border-radius:5px; transition:0.3s; border:1px solid #ccc;}
  .exploding {animation:explode 0.3s ease forwards;}
  @keyframes explode {0%{transform:scale(1);opacity:1;}50%{transform:scale(1.5);opacity:0.7;}100%{transform:scale(0);opacity:0;}}
  #pieces {display:flex; gap:10px; margin-top:20px;}
  .piece {width:50px; height:50px; background:#aaa; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:18px; cursor:pointer; border-radius:5px; border:1px solid #888; transition:0.2s;}
  .piece:hover{transform:scale(1.1);}
  #score {margin-top:20px; font-size:20px; font-weight:bold;}
  #leaderboard {margin-top:20px; width:250px; background:white; padding:10px; border-radius:5px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
  #leaderboard h2{text-align:center;margin:5px 0;}
  #leaderboard ol {padding-left:20px;}
  button {padding:10px 20px; margin-top:10px; cursor:pointer; font-size:16px;}
</style>
</head>
<body>

<h1>Block Blast 8x8 üöÄ</h1>
<div id="game"></div>

<div id="pieces"></div>
<div id="score">ƒêi·ªÉm: 0</div>
<button onclick="resetGame()">B·∫Øt ƒë·∫ßu l·∫°i</button>

<div id="leaderboard">
  <h2>B·∫£ng x·∫øp h·∫°ng</h2>
  <ol id="leaderboardList"></ol>
</div>

<script>
const rows=8, cols=8;
let grid=[], score=0, combo=0;
const gameDiv=document.getElementById('game');
const piecesDiv=document.getElementById('pieces');
const scoreDiv=document.getElementById('score');
const lbList=document.getElementById('leaderboardList');
let currentPieces=[], selectedPiece=null;

// kh·ªëi
function randomPiece(){
  const shapes=[
    [[1]], [[1,1]], [[1],[1]], [[1,1],[1,0]], [[1,1],[1,1]]
  ];
  return shapes[Math.floor(Math.random()*shapes.length)];
}

function createGrid(){
  gameDiv.innerHTML='';
  grid=[];
  for(let r=0;r<rows;r++){
    const row=[];
    for(let c=0;c<cols;c++){
      row.push(0);
      const cell=document.createElement('div');
      cell.className='cell';
      cell.dataset.row=r;
      cell.dataset.col=c;
      gameDiv.appendChild(cell);
    }
    grid.push(row);
  }
}

// t·∫°o kh·ªëi m·ªõi
function generatePieces(){
  piecesDiv.innerHTML='';
  currentPieces=[];
  for(let i=0;i<3;i++){
    const piece=randomPiece();
    currentPieces.push(piece);
    const div=document.createElement('div');
    div.className='piece';
    div.dataset.index=i;
    div.textContent=piece.length+'x'+piece[0].length;
    div.onclick=()=>selectPiece(i);
    piecesDiv.appendChild(div);
  }
}

// ch·ªçn kh·ªëi
function selectPiece(index){
  selectedPiece=currentPieces[index];
}

// click √¥ ƒë·ªÉ ƒë·∫∑t kh·ªëi
gameDiv.addEventListener('click',e=>{
  const cell=e.target;
  if(!cell.classList.contains('cell') || !selectedPiece) return;
  const r=parseInt(cell.dataset.row);
  const c=parseInt(cell.dataset.col);
  if(placePiece(r,c,selectedPiece)){
    currentPieces.splice(currentPieces.indexOf(selectedPiece),1);
    selectedPiece=null;
    generatePieces();
    checkFullLines();
    updateScore();
  }
});

// ƒë·∫∑t kh·ªëi
function placePiece(r,c,piece){
  for(let i=0;i<piece.length;i++){
    for(let j=0;j<piece[i].length;j++){
      if(piece[i][j] && (r+i>=rows || c+j>=cols || grid[r+i][c+j])) return false;
    }
  }
  for(let i=0;i<piece.length;i++){
    for(let j=0;j<piece[i].length;j++){
      if(piece[i][j]){
        grid[r+i][c+j]=1;
      }
    }
  }
  updateGrid();
  return true;
}

// c·∫≠p nh·∫≠t grid
function updateGrid(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const idx=r*cols+c;
      const cell=gameDiv.children[idx];
      cell.style.background=grid[r][c]?'#2196F3':'#eee';
    }
  }
}

// ki·ªÉm tra h√†ng/c·ªôt ƒë·∫ßy, n·ªï + animation + combo
function checkFullLines(){
  let exploded=false;
  // h√†ng
  for(let r=0;r<rows;r++){
    if(grid[r].every(v=>v===1)){
      exploded=true;
      for(let c=0;c<cols;c++){
        const idx=r*cols+c;
        const cell=gameDiv.children[idx];
        cell.classList.add('exploding');
        grid[r][c]=0;
      }
      score+=cols*10*(combo+1);
      combo++;
      setTimeout(()=>updateGrid(),300);
    }
  }
  // c·ªôt
  for(let c=0;c<cols;c++){
    let full=true;
    for(let r=0;r<rows;r++){
      if(grid[r][c]===0) full=false;
    }
    if(full){
      exploded=true;
      for(let r=0;r<rows;r++){
        const idx=r*cols+c;
        const cell=gameDiv.children[idx];
        cell.classList.add('exploding');
        grid[r][c]=0;
      }
      score+=rows*10*(combo+1);
      combo++;
      setTimeout(()=>updateGrid(),300);
    }
  }
  if(!exploded) combo=0;
}

// update score + leaderboard
function updateScore(){
  scoreDiv.textContent='ƒêi·ªÉm: '+score;
  updateLeaderboard();
}

function updateLeaderboard(){
  let lb=JSON.parse(localStorage.getItem('bb_lb')||'[]');
  if(!lb.includes(score)) lb.push(score);
  lb.sort((a,b)=>b-a);
  lb=lb.slice(0,5);
  localStorage.setItem('bb_lb',JSON.stringify(lb));
  lbList.innerHTML='';
  lb.forEach(s=>{
    const li=document.createElement('li');
    li.textContent=s;
    lbList.appendChild(li);
  });
}

function resetGame(){
  score=0;
  combo=0;
  createGrid();
  generatePieces();
  updateScore();
}

// start
resetGame();
</script>

</body>
</html>
