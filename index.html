<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vietisme Chess ♟️</title>
<link rel="stylesheet" href="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"/>
<style>
  body {font-family: Arial,sans-serif; background:#f4f4f4; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
  header {background:#222; color:white; width:100%; padding:20px; text-align:center;}
  #gameContainer {display:flex; margin-top:20px; gap:20px; flex-wrap:wrap; justify-content:center;}
  #board {width:400px;}
  #info {width:250px; background:white; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
  #info h2 {text-align:center;}
  #moves {height:300px; overflow-y:auto; border:1px solid #ddd; padding:5px; background:#fafafa;}
  button {padding:10px 15px; margin-top:10px; font-size:14px; cursor:pointer;}
</style>
</head>
<body>

<header><h1>Vietisme Chess ♟️</h1></header>

<div id="gameContainer">
  <div id="board"></div>
  <div id="info">
    <h2>Thông tin ván cờ</h2>
    <div id="moves"></div>
    <button onclick="resetGame()">Bắt đầu lại</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script src="https://unpkg.com/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script>
const game = new Chess();
const board = Chessboard('board', {
  draggable:true,
  position:'start',
  onDrop: handleMove
});
const movesDiv = document.getElementById('moves');

function updateMoves(){
  movesDiv.innerHTML = '';
  game.history({verbose:true}).forEach((m,i)=>{
    const div = document.createElement('div');
    div.textContent = (i%2===0?((i/2+1)+'. '):'') + m.san;
    movesDiv.appendChild(div);
  });
  movesDiv.scrollTop = movesDiv.scrollHeight;
}

function handleMove(source,target){
  const move = game.move({from:source,to:target,promotion:'q'});
  if(move===null) return 'snapback';
  updateMoves();
  setTimeout(botMove,300);
}

function botMove(){
  if(game.game_over()) return;
  const moves = game.moves({verbose:true});

  // ưu tiên ăn quân
  const capture = moves.filter(m=>m.captured);
  if(capture.length>0){
    game.move(capture[Math.floor(Math.random()*capture.length)].san);
    board.position(game.fen());
    updateMoves();
    return;
  }

  // nhập thành
  const castle = moves.filter(m=>m.flags.includes('k')||m.flags.includes('q'));
  if(castle.length>0){
    game.move(castle[Math.floor(Math.random()*castle.length)].san);
    board.position(game.fen());
    updateMoves();
    return;
  }

  // phát triển Mã/Tượng trung tâm
  const develop = moves.filter(m=>(m.piece==='n'||m.piece==='b')&&['c3','f3','d3','e3','c6','f6','d6','e6'].includes(m.to));
  if(develop.length>0){
    game.move(develop[Math.floor(Math.random()*develop.length)].san);
    board.position(game.fen());
    updateMoves();
    return;
  }

  // random còn lại
  const moveRandom = moves[Math.floor(Math.random()*moves.length)];
  game.move(moveRandom.san);
  board.position(game.fen());
  updateMoves();
}

function resetGame(){
  game.reset();
  board.start();
  movesDiv.innerHTML='';
}
</script>

</body>
</html>
